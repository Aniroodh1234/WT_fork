<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chatbot</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }

/* Toggle Button */
.chatbot-toggle { position:fixed; bottom:30px; right:30px; width:60px; height:60px; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer; box-shadow:0 4px 20px rgba(0,0,0,0.3); transition:0.3s; z-index:1000; }
.chatbot-toggle:hover { transform:scale(1.1); box-shadow:0 6px 25px rgba(0,0,0,0.4); }
.chatbot-toggle svg { width:30px; height:30px; fill:white; }

/* Chatbot Container */
.chatbot-container { position:fixed; bottom:100px; right:30px; width:380px; height:550px; background:white; border-radius:20px; box-shadow:0 10px 40px rgba(0,0,0,0.3); display:none; flex-direction:column; overflow:hidden; z-index:999; animation:slideUp 0.3s ease; }
.chatbot-container.active { display:flex; }
@keyframes slideUp { from {opacity:0; transform:translateY(20px);} to {opacity:1; transform:translateY(0);} }

/* Header */
.chatbot-header { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; padding:20px; display:flex; justify-content:space-between; align-items:center; }
.chatbot-header h3 { font-size:18px; font-weight:600; }
.chatbot-header p { font-size:12px; opacity:0.9; margin-top:4px; }
.close-btn { background:rgba(255,255,255,0.2); border:none; width:32px; height:32px; border-radius:50%; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:0.3s; }
.close-btn:hover { background:rgba(255,255,255,0.3); }
.close-btn svg { width:16px; height:16px; stroke:white; stroke-width:2; }

/* Messages Area */
.chat-messages { flex:1; padding:20px; overflow-y:auto; background:#f8f9fa; }
.message { margin-bottom:16px; display:flex; gap:10px; }
.message.bot { justify-content:flex-start; }
.message.user { justify-content:flex-end; }
.message-content { max-width:75%; padding:12px 16px; border-radius:18px; font-size:14px; line-height:1.5; }
.message.bot .message-content { background:white; color:#333; border-bottom-left-radius:4px; box-shadow:0 2px 8px rgba(0,0,0,0.08); }
.message.user .message-content { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; border-bottom-right-radius:4px; }

/* Input Area */
.chat-input-area { padding:20px; background:white; border-top:1px solid #e0e0e0; display:flex; gap:10px; }
.chat-input { flex:1; padding:12px 16px; border:1px solid #e0e0e0; border-radius:25px; font-size:14px; outline:none; transition:0.3s; }
.chat-input:focus { border-color:#667eea; }
.send-btn { width:45px; height:45px; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); border:none; border-radius:50%; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:0.2s; }
.send-btn:hover { transform:scale(1.05); }
.send-btn:active { transform:scale(0.95); }
.send-btn svg { width:20px; height:20px; fill:white; }

/* Scrollbar */
.chat-messages::-webkit-scrollbar { width:6px; }
.chat-messages::-webkit-scrollbar-track { background:#f1f1f1; }
.chat-messages::-webkit-scrollbar-thumb { background:#ccc; border-radius:3px; }
.chat-messages::-webkit-scrollbar-thumb:hover { background:#999; }
</style>
</head>
<body>

<!-- Toggle Button -->
<div class="chatbot-toggle" id="chatbotToggle">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>
    </svg>
</div>

<!-- Chatbot Container -->
<div class="chatbot-container" id="chatbotContainer">
    <!-- Header -->
    <div class="chatbot-header">
        <div>
            <h3>AI Assistant</h3>
            <p>Online - Here to help!</p>
        </div>
        <button class="close-btn" id="closeBtn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
        </button>
    </div>

    <!-- Messages -->
    <div class="chat-messages" id="chatMessages">
        <div class="message bot">
            <div class="message-content">Hello! ðŸ‘‹ Can I help you with some product recommendations today?</div>
        </div>
    </div>

    <!-- Input -->
    <div class="chat-input-area">
        <input type="text" class="chat-input" id="chatInput" placeholder="Type your message..." autocomplete="off">
        <button class="send-btn" id="sendBtn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
            </svg>
        </button>
    </div>
</div>

<script>
const chatbotToggle = document.getElementById('chatbotToggle');
const chatbotContainer = document.getElementById('chatbotContainer');
const closeBtn = document.getElementById('closeBtn');
const sendBtn = document.getElementById('sendBtn');
const chatInput = document.getElementById('chatInput');
const chatMessages = document.getElementById('chatMessages');

chatbotToggle.addEventListener('click', () => {
    chatbotContainer.classList.add('active');
    chatInput.focus();
});

closeBtn.addEventListener('click', () => {
    chatbotContainer.classList.remove('active');
});

async function sendMessage() {
    const message = chatInput.value.trim();
    if (!message) return;

    // User message
    const userMessage = document.createElement('div');
    userMessage.className = 'message user';
    userMessage.innerHTML = `<div class="message-content">${message}</div>`;
    chatMessages.appendChild(userMessage);
    chatInput.value = '';
    chatMessages.scrollTop = chatMessages.scrollHeight;

    // Loading message
    const loadingMessage = document.createElement('div');
    loadingMessage.className = 'message bot';
    loadingMessage.innerHTML = `<div class="message-content">Typing...</div>`;
    chatMessages.appendChild(loadingMessage);
    chatMessages.scrollTop = chatMessages.scrollHeight;

    try {
        const res = await fetch('https://wt-m6ke.onrender.com/api/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message })
        });

        const data = await res.json();

        // Render formatted HTML from backend
        loadingMessage.innerHTML = `<div class="message-content">${data.reply}</div>`;
        chatMessages.scrollTop = chatMessages.scrollHeight;
    } catch (err) {
        loadingMessage.innerHTML = `<div class="message-content">Error connecting to AI. Try again.</div>`;
        console.error(err);
    }
}

sendBtn.addEventListener('click', sendMessage);
chatInput.addEventListener('keypress', e => {
    if (e.key === 'Enter') sendMessage();
});
</script>
</body>
</html>
